os: [linux, osx]
env:
  matrix:
    - GVM_GO=go1.4.2 # release
  # - GVM_GO=tip # pre-release
  global:
    - GVMINSTALLER_URL=https://github.com/moovweb/gvm/raw/master/binscripts/gvm-installer
language: c
install:
  - test x$TRAVIS_OS_NAME = xosx && export CXX=clang++ CC=clang || true # default CC=gcc for `language: c'
  - if type -t gvm; then gvm get; else curl -sSL $GVMINSTALLER_URL | bash; fi
  - source ~/.gvm/scripts/gvm
  - gvm version
  - gvm install $GVM_GO --binary # || gvm install $GVM_GO
  - gvm use $GVM_GO; gvm list
  - cd; mkdir -p gopath/src; mv build gopath/src/github.com; cd gopath/src/github.com/$TRAVIS_REPO_SLUG
  - export GOPATH=~/gopath:$GOPATH PATH=~/gopath/bin:$PATH
  - go version; go env
  - make init
script:
  - make test all # go test then the build

# after_deploy: [echo done deploying]
# before_deploy: echo deploying
deploy:
  provider: releases
  api_key:
    secure: EFMPpR2rZkCdlfWuz7bE4ji3/0OL+fgIq+lXJ5SWDUG7aYWVqlLpR1hYXb0yqy8YA2Rg3xvAfPY/sFZvCyUMv0Wx1ZhiVzNvAUduzYFqovvHoYS4nuv0bXWis4YBnx7zJ7uikl5aGAOB8g0L+ofsUAswlDU5M9g9stDG4upWSgw=
  skip_clean: true
  file: $HOME/gopath/bin/ostent # file to upload OR [file1, file2] list
# file_glob: If files should be interpreted as globs (* and ** wildcards). Defaults to false.
# release-number: Overide automatic release detection, set a release manually.
  on: {tags: true} # repo: ostrost/ostent
#    branch: ''
